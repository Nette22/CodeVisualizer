{"nodes" : [{"id" : 0, "x" : 225, "y" : 398, "width" : 172, "height" : 41, "nodename" : "HTML Platformer Game", "txt" : ""},{"id" : 1, "x" : 905, "y" : 395, "width" : 158, "height" : 42, "nodename" : "AnimatedGameObject", "txt" : "/**\r\n    Displays an animated Game Object\r\n    @author <a href=\"mailto:matthewcasperson@gmail.com\">Matthew Casperson</a>\r\n    @class\r\n*/\r\nfunction AnimatedGameObject()\r\n{\r\n    /**\r\n        Defines the current frame that is to be rendered\r\n        @type Number\r\n     */\r\n    this.currentFrame = 0;\r\n    /**\r\n        Defines the frames per second of the animation\r\n        @type Number\r\n     */\r\n    this.timeBetweenFrames = 0;\r\n    /**\r\n        The number of individual frames held in the image\r\n        @type Number\r\n     */\r\n    /**\r\n        Time until the next frame\r\n        @type number\r\n     */\r\n    this.timeSinceLastFrame = 0;\r\n    /**\r\n        The width of each individual frame\r\n        @type Number\r\n     */\r\n    this.frameWidth = 0;\r\n\r\n    /**\r\n        Initialises this object\r\n        @param image The image to be displayed\r\n\t\t@param x The position on the X axis\r\n        @param y The position on the Y axis\r\n\t\t@param z The depth\r\n        @param frameCount The number of animation frames in the image\r\n        @param fps The frames per second to animate this object at\r\n    */\r\n    this.startupAnimatedGameObject = function(/**Image*/ image, /**Number*/ x, /**Number*/ y, /**Number*/ z, /**Number*/ frameCount, /**Number*/ fps)\r\n    {\r\n        if (frameCount <= 0) throw \"framecount can not be <= 0\";\r\n        if (fps <= 0) throw \"fps can not be <= 0\"\r\n\r\n        this.startupVisualGameObject(image, x, y, z);\r\n        this.currentFrame = 0;\r\n        this.frameCount = frameCount;\r\n        this.timeBetweenFrames = 1/fps;\r\n        this.timeSinceLastFrame = this.timeBetweenFrames;\r\n        this.frameWidth = this.image.width / this.frameCount;\r\n\r\n        return this;\r\n    }\r\n\r\n    this.setAnimation = function(/**Image*/ image, /**Number*/ frameCount, /**Number*/ fps)\r\n    {\r\n        if (frameCount <= 0) throw \"framecount can not be <= 0\";\r\n        if (fps <= 0) throw \"fps can not be <= 0\"\r\n\r\n        this.image = image;\r\n        this.currentFrame = 0;\r\n        this.frameCount = frameCount;\r\n        this.timeBetweenFrames = 1/fps;\r\n        this.timeSinceLastFrame = this.timeBetweenFrames;\r\n        this.frameWidth = this.image.width / this.frameCount;\r\n    }\r\n\r\n    /**\r\n        Draws this element to the back buffer\r\n        @param dt Time in seconds since the last frame\r\n\t\t@param context The context to draw to\r\n\t\t@param xScroll The global scrolling value of the x axis\r\n\t\t@param yScroll The global scrolling value of the y axis\r\n    */\r\n    this.draw = function(/**Number*/ dt, /**CanvasRenderingContext2D*/ context, /**Number*/ xScroll, /**Number*/ yScroll)\r\n    {\r\n        var sourceX = this.frameWidth * this.currentFrame;\r\n        context.drawImage(this.image, sourceX, 0, this.frameWidth, this.image.height, this.x - xScroll, this.y - yScroll, this.frameWidth, this.image.height);\r\n\r\n        this.timeSinceLastFrame -= dt;\r\n        if (this.timeSinceLastFrame <= 0)\r\n        {\r\n           this.timeSinceLastFrame = this.timeBetweenFrames;\r\n           ++this.currentFrame;\r\n           this.currentFrame %= this.frameCount;\r\n        }\r\n    }\r\n\r\n    this.shutdownAnimatedGameObject = function()\r\n    {\r\n        this.shutdownVisualGameObject();\r\n    }\r\n\r\n    this.shutdown = function()\r\n    {\r\n        this.shutdownAnimatedGameObject();\r\n    }\r\n\r\n    this.collisionArea = function()\r\n    {\r\n        return new Rectangle().startupRectangle(this.x, this.y, this.frameWidth, this.image.height);\r\n    }\r\n}\r\n\r\nAnimatedGameObject.prototype = new VisualGameObject;"},{"id" : 2, "x" : 480, "y" : 156, "width" : 150, "height" : 44, "nodename" : "ApplicationManager", "txt" : "/**\r\n    The ApplicationManager is used to manage the application itself.\r\n    @author <a href=\"mailto:matthewcasperson@gmail.com\">Matthew Casperson</a>\r\n    @class\r\n*/\r\nfunction ApplicationManager()\r\n{\r\n    this.canvasWidth = 0;\r\n    this.canvasHeight = 0;\r\n\r\n    /**\r\n        Initialises this object\r\n        @param canvasWidth      The width of the canvas\r\n        @param canvasHeight     The height of the canvas\r\n        @return                 A reference to the initialised object\r\n\r\n    */\r\n    this.startupApplicationManager = function(canvasWidth, canvasHeight)\r\n    {\r\n        g_ApplicationManager = this;\r\n        this.canvasWidth = canvasWidth;\r\n        this.canvasHeight = canvasHeight;\r\n\r\n        this.openMainMenu();\r\n\r\n        return this;\r\n    }\r\n\r\n    this.startLevel = function()\r\n    {\r\n        g_GameObjectManager.shutdownAll();\r\n        this.level = new Level().startupLevel(this.canvasWidth, this.canvasHeight);\r\n        this.background3 = new RepeatingGameObject().startupRepeatingGameObject(g_ResourceManager.background2, 0, 100, 3, 600, 320, 0.75);\r\n        this.background2 = new RepeatingGameObject().startupRepeatingGameObject(g_ResourceManager.background1, 0, 100, 2, 600, 320, 0.5);\r\n        this.background = new RepeatingGameObject().startupRepeatingGameObject(g_ResourceManager.background0, 0, 0, 1, 600, 320, 0.25);\r\n        g_player = new Player().startupPlayer(this.level);\r\n        this.updateScore();\r\n    }\r\n\r\n    this.openMainMenu = function()\r\n    {\r\n        g_GameObjectManager.shutdownAll();\r\n        g_GameObjectManager.xScroll = 0;\r\n        g_GameObjectManager.yScroll = 0;\r\n        g_score = 0;\r\n        this.mainMenu = new MainMenu().startupMainMenu();\r\n    }\r\n\r\n    this.updateScore = function()\r\n    {\r\n        var score = document.getElementById(\"Score\");\r\n        score.innerHTML = String(g_score);\r\n    }\r\n}"},{"id" : 3, "x" : 488, "y" : 397.5, "width" : 149, "height" : 42, "nodename" : "GameObject", "txt" : "/**\r\n    The base class for all elements that appear in the game.\r\n    @author <a href=\"mailto:matthewcasperson@gmail.com\">Matthew Casperson</a>\r\n    @class\r\n*/\r\nfunction GameObject()\r\n{\r\n    /** Display depth order. A smaller zOrder means the element is rendered first, and therefor\r\n        in the background.\r\n        @type Number\r\n    */\r\n    this.zOrder = 0;\r\n    /**\r\n        The position on the X axis\r\n        @type Number\r\n    */\r\n    this.x = 0;\r\n    /**\r\n        The position on the Y axis\r\n        @type Number\r\n    */\r\n    this.y = 0;\r\n    \r\n    /**\r\n        Initialises the object, and adds it to the list of objects held by the GameObjectManager.\r\n        @param x        The position on the X axis\r\n        @param y        The position on the Y axis\r\n        @param z        The z order of the element (elements in the background have a lower z value)\r\n    */\r\n    this.startupGameObject = function(/**Number*/ x, /**Number*/ y, /**Number*/ z)\r\n    {\r\n        this.zOrder = z;\r\n        this.x = x;\r\n        this.y = y;\r\n        g_GameObjectManager.addGameObject(this);\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n        Cleans up the object, and removes it from the list of objects held by the GameObjectManager.\r\n    */\r\n    this.shutdownGameObject = function()\r\n    {\r\n        g_GameObjectManager.removeGameObject(this);\r\n    }\r\n\r\n    this.shutdown = function()\r\n    {\r\n         this.shutdownGameObject();\r\n    }\r\n}"},{"id" : 4, "x" : 483, "y" : 236.5, "width" : 149, "height" : 46, "nodename" : "GameObjectManager", "txt" : "/**\r\n    A manager for all the objects in the game\r\n    @author <a href=\"mailto:matthewcasperson@gmail.com\">Matthew Casperson</a>\r\n    @class\r\n*/\r\nfunction GameObjectManager()\r\n{\r\n    /** An array of game objects \r\n        @type Arary\r\n    */\r\n    this.gameObjects = new Array();\r\n    /** An array of new game objects\r\n        @type Arary\r\n    */\r\n    this.addedGameObjects = new Array();\r\n    /** An array of removed game objects\r\n        @type Arary\r\n    */\r\n    this.removedGameObjects = new Array();\r\n    /** The time that the last frame was rendered  \r\n        @type Date\r\n    */\r\n    this.lastFrame = new Date().getTime();\r\n    /** The global scrolling value of the x axis  \r\n        @type Number\r\n    */\r\n    this.xScroll = 0;\r\n    /** The global scrolling value of the y axis  \r\n        @type Number\r\n    */\r\n    this.yScroll = 0;\r\n    /** A reference to the canvas element  \r\n        @type HTMLCanvasElement\r\n    */\r\n    this.canvas = null;\r\n    /** A reference to the 2D context of the canvas element\r\n        @type CanvasRenderingContext2D\r\n    */\r\n    this.context2D = null;\r\n    /** A reference to the in-memory canvas used as a back buffer \r\n        @type HTMLCanvasElement\r\n    */\r\n    this.backBuffer = null;\r\n    /** A reference to the backbuffer 2D context \r\n        @type CanvasRenderingContext2D\r\n    */\r\n    this.backBufferContext2D = null;\r\n    /** True if the canvas element is supported, false otherwise\r\n        @type Boolean\r\n    */\r\n    this.canvasSupported = false;\r\n\t/** True if the resources supplied to the ResourceManager are all loaded, false otherwise\r\n        @type Boolean\r\n    */\r\n    this.resourcesLoaded = false;\r\n\t/** The current colour of the loading screen\r\n        @type Number\r\n    */\r\n\tthis.loadingScreenCol = 0;\r\n\t/** The direction of the changes to the loading screen colour.\r\n\t\t1 = colour moving towards white\r\n\t\t-1 = colour moving topwards balck\r\n        @type Number\r\n    */\t\r\n\tthis.loadingScreenColDirection = 1;\r\n\t/** How quickly to change the loading screen colour per second\r\n        @type Number\r\n    */\r\n\tthis.loadingScreenColSpeed = 255;\r\n\r\n    /**\r\n        Initialises this object\r\n        @return A reference to the initialised object\r\n    */\r\n    this.startupGameObjectManager = function()\r\n    {\r\n        // set the global pointer to reference this object\r\n        g_GameObjectManager = this;\r\n\r\n        // watch for keyboard events\r\n        document.onkeydown = function(event){g_GameObjectManager.keyDown(event);}\r\n        document.onkeyup = function(event){g_GameObjectManager.keyUp(event);}\r\n\r\n        // get references to the canvas elements and their 2D contexts\r\n        this.canvas = document.getElementById('canvas');\r\n\r\n        // if the this.canvas.getContext function does not exist it is a safe bet that\r\n        // the current browser does not support the canvas element.\r\n        // in this case we don't go any further, which will save some debuggers (like\r\n        // the IE8 debugger) from throwing up a lot of errors.\r\n        if (this.canvas.getContext)\r\n        {\r\n            this.canvasSupported = true;\r\n            this.context2D = this.canvas.getContext('2d');\r\n            this.backBuffer = document.createElement('canvas');\r\n            this.backBuffer.width = this.canvas.width;\r\n            this.backBuffer.height = this.canvas.height;\r\n            this.backBufferContext2D = this.backBuffer.getContext('2d');\r\n        }\r\n\r\n        // create a new ResourceManager\r\n        new ResourceManager().startupResourceManager(\r\n            [{name: 'runLeft', src: 'run_left.png'},\r\n            {name: 'runRight', src: 'run_right.png'},\r\n            {name: 'idleLeft', src: 'idle_left.png'},\r\n            {name: 'idleRight', src: 'idle_right.png'},\r\n            {name: 'background0', src: 'jsplatformer4_b0.png'},\r\n            {name: 'background1', src: 'jsplatformer4_b1.png'},\r\n            {name: 'background2', src: 'jsplatformer4_b2.png'},\r\n            {name: 'block', src: 'BlockA0.png'},\r\n            {name: 'gem', src: 'Gem.png'},\r\n            {name: 'mainmenu', src: 'mainmenu.png'},\r\n            {name: 'portal', src: 'portal.png'}]);\r\n\r\n        // use setInterval to call the draw function\r\n        setInterval(function(){g_GameObjectManager.draw();}, SECONDS_BETWEEN_FRAMES);\r\n        \r\n        return this;        \r\n    }\r\n    \r\n    /**\r\n        The render loop\r\n    */\r\n    this.draw = function ()\r\n    {\r\n        // calculate the time since the last frame\r\n        var thisFrame = new Date().getTime();\r\n        var dt = (thisFrame - this.lastFrame)/1000;\r\n        this.lastFrame = thisFrame;\r\n\r\n        if (!this.resourcesLoaded)\r\n        {\r\n            var numLoaded = 0;\r\n            for (i = 0; i < g_ResourceManager.imageProperties.length; ++i)\r\n            {\r\n                if (g_ResourceManager[g_ResourceManager.imageProperties[i]].complete)\r\n                {\r\n                    ++numLoaded;\r\n                }\r\n            }\r\n            if ( numLoaded == g_ResourceManager.imageProperties.length )\r\n            {\r\n                // create a new ApplicationManager\r\n                new ApplicationManager().startupApplicationManager(this.canvas.width, this.canvas.height);\r\n                this.resourcesLoaded = true;\r\n            }\r\n            else\r\n            {\r\n                this.loadingScreenCol += this.loadingScreenColDirection * this.loadingScreenColSpeed * dt;\r\n                if (this.loadingScreenCol > 255)\r\n                {\r\n                    this.loadingScreenCol = 255;\r\n                    this.loadingScreenColDirection = -1;\r\n                }\r\n                else if (this.loadingScreenCol < 0)\r\n                {\r\n                    this.loadingScreenCol = 0;\r\n                    this.loadingScreenColDirection = 1;\r\n                }\r\n                this.context2D.fillStyle = \"rgb(\" + parseInt(this.loadingScreenCol) + \",\" + parseInt(this.loadingScreenCol) + \",\" + parseInt(this.loadingScreenCol) + \")\";\r\n                this.context2D.fillRect (0, 0, this.canvas.width, this.canvas.height);\r\n            }\r\n        }\r\n        \r\n        // clear the drawing contexts\r\n        if (this.canvasSupported && this.resourcesLoaded)\r\n        {\r\n            this.backBufferContext2D.clearRect(0, 0, this.backBuffer.width, this.backBuffer.height);\r\n\r\n            this.addNewGameObjects();\r\n            this.removeOldGameObjects();\r\n        \r\n            // first update all the game objects\r\n            for (var x = 0; x < this.gameObjects.length; ++x)\r\n            {\r\n                if (this.gameObjects[x].update)\r\n                {\r\n                    this.gameObjects[x].update(dt, this.backBufferContext2D, this.xScroll, this.yScroll);\r\n                }\r\n            }\r\n\r\n            // then draw the game objects\r\n            for (var x = 0; x < this.gameObjects.length; ++x)\r\n            {\r\n                if (this.gameObjects[x].draw)\r\n                {\r\n                    this.gameObjects[x].draw(dt, this.backBufferContext2D, this.xScroll, this.yScroll);\r\n                }\r\n            }\r\n\r\n            // copy the back buffer to the displayed canvas\r\n            this.context2D.drawImage(this.backBuffer, 0, 0);\r\n        }        \r\n    };\r\n\r\n    this.shutdownAll = function()\r\n    {\r\n        for (var x = 0; x < this.gameObjects.length; ++x)\r\n        {\r\n            if (this.gameObjects[x].shutdown)\r\n            {\r\n                this.gameObjects[x].shutdown();\r\n            }\r\n        }\r\n\r\n        this.removeOldGameObjects();\r\n    }\r\n    \r\n    /**\r\n        Adds a new GameObject to the gameObjects collection\r\n        @param gameObject The object to add\r\n    */\r\n    this.addGameObject = function(gameObject)\r\n    {\r\n        this.addedGameObjects.push(gameObject);\r\n    };\r\n\r\n    this.addNewGameObjects = function()\r\n    {\r\n        if (this.addedGameObjects.length != 0)\r\n        {\r\n            for (var x = 0; x < this.addedGameObjects.length; ++x)\r\n            {\r\n                this.gameObjects.push(this.addedGameObjects[x]);\r\n            }\r\n\r\n            this.addedGameObjects.clear();\r\n            this.gameObjects.sort(function(a,b){return a.zOrder - b.zOrder;});\r\n        }\r\n    }\r\n\r\n    /**\r\n        Removes a GameObject from the gameObjects collection\r\n        @param gameObject The object to remove\r\n    */\r\n    this.removeGameObject = function(gameObject)\r\n    {\r\n        this.removedGameObjects.push(gameObject);\r\n    }\r\n\r\n    this.removeOldGameObjects = function()\r\n    {\r\n        if (this.removedGameObjects.length != 0)\r\n        {\r\n            for (var x = 0; x < this.removedGameObjects.length; ++x)\r\n            {\r\n                this.gameObjects.removeObject(this.removedGameObjects[x]);\r\n            }\r\n            this.removedGameObjects.clear();\r\n        }\r\n    }\r\n\r\n    this.keyDown = function(event)\r\n    {\r\n        for (var x = 0; x < this.gameObjects.length; ++x)\r\n        {\r\n            if (this.gameObjects[x].keyDown)\r\n            {\r\n                this.gameObjects[x].keyDown(event);\r\n            }\r\n        }\r\n    }\r\n\r\n    this.keyUp = function(event)\r\n    {\r\n        for (var x = 0; x < this.gameObjects.length; ++x)\r\n        {\r\n            if (this.gameObjects[x].keyUp)\r\n            {\r\n                this.gameObjects[x].keyUp(event);\r\n            }\r\n        }\r\n    }\r\n}"},{"id" : 5, "x" : 488, "y" : 557, "width" : 156, "height" : 43, "nodename" : "Level", "txt" : "/**\r\n    A class to represent the level\r\n    @author <a href=\"mailto:matthewcasperson@gmail.com\">Matthew Casperson</a>\r\n    @class\r\n*/\r\nfunction Level()\r\n{\r\n    this.blocks = new Array();\r\n    this.powerups = new Object;\r\n    this.blockWidth = 64;\r\n    this.blockHeight = 48;\r\n\r\n    /**\r\n        Initialises this object\r\n    */\r\n    this.startupLevel = function(canvasWidth, canvasHeight)\r\n    {\r\n        this.blocks[0] = 3;\r\n        this.blocks[1] = 2;\r\n        this.blocks[2] = 1;\r\n        this.blocks[3] = 1;\r\n        this.blocks[4] = 1;\r\n        this.blocks[5] = 1;\r\n        this.blocks[6] = 2;\r\n        this.blocks[7] = 3;\r\n        this.blocks[8] = 2;\r\n        this.blocks[9] = 1;\r\n        this.blocks[10] = 2;\r\n        this.blocks[11] = 3;\r\n        this.blocks[12] = 4;\r\n        this.blocks[13] = 5;\r\n        this.blocks[14] = 4;\r\n        this.blocks[15] = 3;\r\n\r\n        this.powerups['1'] = 'Gem';\r\n        this.powerups['6'] = 'Gem';\r\n        this.powerups['10'] = 'Gem';\r\n        this.powerups['14'] = 'LevelEndPost';\r\n\r\n        this.addBlocks(canvasWidth, canvasHeight);\r\n        this.addPowerups(canvasWidth, canvasHeight);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n        Adds the blocks to the screen by creating VisualGameObjects\r\n    */\r\n    this.addBlocks = function(canvasWidth, canvasHeight)\r\n    {\r\n        for (var x = 0; x < this.blocks.length; ++x)\r\n        {\r\n            for (var y = 0; y < this.blocks[x]; ++y)\r\n            {\r\n                new VisualGameObject().startupVisualGameObject(g_ResourceManager.block, x * this.blockWidth, canvasHeight - (y + 1) * this.blockHeight, 4);\r\n            }\r\n        }\r\n    }\r\n\r\n    this.addPowerups = function(canvasWidth, canvasHeight)\r\n    {\r\n        for (var x = 0; x < this.blocks.length; ++x)\r\n        {\r\n            if (this.powerups[x])\r\n            {\r\n                var xPosition = x * this.blockWidth + this.blockWidth / 2;\r\n                var yPosition = canvasHeight - this.groundHeight(x);\r\n\r\n                switch(this.powerups[x])\r\n                 {\r\n                    case 'Gem':\r\n                        new Powerup().startupPowerup(10, g_ResourceManager.gem, xPosition - g_ResourceManager.gem.width / 2, yPosition - g_ResourceManager.gem.height, 4, 1, 1);\r\n                        break;\r\n                    case 'LevelEndPost':\r\n                        new LevelEndPost().startupLevelEndPost(g_ResourceManager.portal, xPosition - g_ResourceManager.portal.width / 2 / 4, yPosition - g_ResourceManager.portal.height, 4);\r\n                        break;\r\n                 }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n        @return     The block under the specified x position\r\n        @param x    The x position to test\r\n    */\r\n    this.currentBlock = function(x)\r\n    {\r\n        return parseInt( x / this.blockWidth);\r\n    }\r\n    \r\n    /**\r\n        @return             The hieght of the ground under the specified block\r\n        @param blockIndex   The block number\r\n    */\r\n    this.groundHeight = function(blockIndex)\r\n    {\r\n        if (blockIndex < 0 || blockIndex > this.blocks.length) return 0;\r\n\r\n        return this.blocks[blockIndex] *  this.blockHeight;\r\n    }\r\n}"},{"id" : 6, "x" : 1152.75, "y" : 397, "width" : 170, "height" : 46, "nodename" : "LevelEndPost", "txt" : "/**\r\n    An object that causes the level to end when it it touched\r\n    @author <a href=\"mailto:matthewcasperson@gmail.com\">Matthew Casperson</a>\r\n    @class\r\n*/\r\nfunction LevelEndPost()\r\n{\r\n\r\n    this.startupLevelEndPost = function(/**Image*/ image, /**Number*/ x, /**Number*/ y, /**Number*/ z)\r\n    {\r\n        this.startupAnimatedGameObject(image, x, y, z, 4, 10);\r\n        return this;\r\n    }\r\n\r\n    this.shutdown = function()\r\n    {\r\n        this.shutdownLevelEndPost();\r\n    }\r\n\r\n    this.shutdownLevelEndPost = function()\r\n    {\r\n        this.shutdownAnimatedGameObject();\r\n    }\r\n\r\n    /**\r\n        Updates the object\r\n        @param dt The time since the last frame in seconds\r\n        @param context The drawing context\r\n        @param xScroll The global scrolling value of the x axis\r\n        @param yScroll The global scrolling value of the y axis\r\n    */\r\n\tthis.update = function (/**Number*/ dt, /**CanvasRenderingContext2D*/context, /**Number*/ xScroll, /**Number*/ yScroll)\r\n    {\r\n        if (this.collisionArea().intersects(g_player.collisionArea()))\r\n        {\r\n            g_ApplicationManager.openMainMenu();\r\n            this.shutdown();            \r\n        }\r\n    }\r\n}\r\nLevelEndPost.prototype = new AnimatedGameObject;"},{"id" : 7, "x" : 480, "y" : 78, "width" : 147, "height" : 41, "nodename" : "Main", "txt" : "/** target frames per second  \r\n    @type Number\r\n*/\r\nvar FPS = 30;\r\n/** time between frames \r\n    @type Number\r\n*/\r\nvar SECONDS_BETWEEN_FRAMES = 1 / FPS;\r\n/** A global reference to the GameObjectManager instance  \r\n    @type GameObjectManager\r\n*/\r\nvar g_GameObjectManager = null;\r\n/** A global reference to the ApplicationManager instance  \r\n    @type ApplicationManager\r\n*/\r\nvar g_ApplicationManager = null;\r\n/** A global reference to the ResourceManager instance\r\n    @type ResourceManager\r\n*/\r\nvar g_ResourceManager = null;\r\n/** The players score\r\n    @type Number\r\n */\r\nvar g_score = 0;\r\n/** A reference to the player\r\n    @type Player    \r\n */\r\nvar g_player = null;\r\n/** An image to be used by the application\r\n    @type Image\r\n*/\r\n\r\n// The entry point of the application is set to the init function\r\nwindow.onload = init;\r\n\r\n/**\r\n    Application entry point\r\n*/\r\nfunction init()\r\n{\r\n    new GameObjectManager().startupGameObjectManager();\r\n}"},{"id" : 8, "x" : 904, "y" : 238, "width" : 146, "height" : 41, "nodename" : "MainMenu", "txt" : "/**\r\n    The main menu screen\r\n    @author <a href=\"mailto:matthewcasperson@gmail.com\">Matthew Casperson</a>\r\n    @class\r\n*/\r\nfunction MainMenu()\r\n{\r\n    this.startupMainMenu = function()\r\n    {\r\n        this.startupVisualGameObject(g_ResourceManager.mainmenu, 0, 0, 1);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n        Called when a key is pressed\r\n        @param event Event Object\r\n    */\r\n    this.keyDown = function(event)\r\n    {\r\n        g_ApplicationManager.startLevel();\r\n    }\r\n}\r\nMainMenu.prototype = new VisualGameObject;"},{"id" : 9, "x" : 1153.75, "y" : 477.5, "width" : 169, "height" : 42, "nodename" : "Player", "txt" : "/**\r\n    A class to represent the player on the screen\r\n    @author <a href=\"mailto:matthewcasperson@gmail.com\">Matthew Casperson</a>\r\n    @class\r\n*/\r\nfunction Player()\r\n{\r\n    /** The maximum height of the jump\r\n        @type Number\r\n     */\r\n    this.jumpHeight = 64;\r\n    /** The constant or half PI\r\n        @type Number\r\n     */\r\n    this.halfPI = Math.PI / 2;\r\n    /** The amount of time to spend in the air when jumping\r\n        @type Number\r\n     */\r\n    this.jumpHangTime = 0.5;\r\n    /** The speed to progress alone the sine wave that defines\r\n        the jumping arc\r\n        @type Number\r\n     */\r\n    this.jumpSinWaveSpeed = this.halfPI / this.jumpHangTime;\r\n    /** The current position on the sine wave that defines the jump arc\r\n        @type Number\r\n     */\r\n    this.jumpSinWavePos = 0;\r\n    /** The rate to fall at\r\n        @type Number\r\n     */\r\n    this.fallMultiplyer = 1.5;\r\n    /** True when the player is on the ground, false otherwise\r\n        @type Boolean\r\n     */\r\n    this.grounded = true;\r\n    /** the players running speed\r\n        @type Number\r\n     */\r\n    this.speed = 75;\r\n    /** True if the player is moving left, false otherwise\r\n        @type Boolean\r\n     */\r\n    this.left = false;\r\n    /** True if the player is moving right, false otherwise\r\n        @type Boolean\r\n     */\r\n    this.right = false;\r\n    /** A reference to the level object\r\n        @type Level\r\n    */\r\n    this.level = null;\r\n    /** The distance between the player and the edge of the screen\r\n        @type Number\r\n     */\r\n    this.screenBorder = 100;\r\n\r\n    /**\r\n        Initialises this object\r\n    */\r\n    this.startupPlayer = function(level)\r\n    {\r\n        this.startupAnimatedGameObject(g_ResourceManager.idleLeft, 300, 400 - 48 - 48, 4, 6, 20);\r\n        this.level = level;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n        Called when a key is pressed\r\n        @param event Event Object\r\n    */\r\n    this.keyDown = function(event)\r\n    {\r\n        var updateRequired = false;\r\n\r\n        // left\r\n        if (event.keyCode == 37 && !this.left)\r\n        {\r\n            this.left = true;\r\n            updateRequired = true;\r\n        }\r\n        // right\r\n        if (event.keyCode == 39 && !this.right)\r\n        {\r\n            this.right = true;\r\n            updateRequired = true;\r\n        }\r\n        if (event.keyCode == 32 && this.grounded)\r\n        {\r\n            this.grounded = false;\r\n            this.jumpSinWavePos = 0;\r\n        }\r\n\r\n        if (updateRequired)\r\n            this.updateAnimation();\r\n\r\n    }\r\n\r\n    /**\r\n        Called when a key is pressed\r\n        @param event Event Object\r\n    */\r\n    this.keyUp = function(event)\r\n    {\r\n        // left\r\n        if (event.keyCode == 37)\r\n        {\r\n            this.left = false;\r\n            this.setAnimation(g_ResourceManager.idleLeft, 6, 20);\r\n        }\r\n        // right\r\n        if (event.keyCode == 39)\r\n        {\r\n            this.right = false;\r\n            this.setAnimation(g_ResourceManager.idleRight, 6, 20);\r\n        }\r\n\r\n        this.updateAnimation();\r\n    }\r\n\r\n    /**\r\n        Updates the current animation depending on the movement\r\n        of the player. This accounts for the fact that both\r\n        the left and right arrow keys can be pressed at the\r\n        same time.\r\n    */\r\n    this.updateAnimation = function()\r\n    {\r\n       if (this.right && this.left)\r\n            this.setAnimation(g_ResourceManager.idleLeft, 6, 20);\r\n        else if (this.right)\r\n            this.setAnimation(g_ResourceManager.runRight, 12, 20);\r\n        else if (this.left)\r\n            this.setAnimation(g_ResourceManager.runLeft, 12, 20);\r\n    }\r\n\r\n    /**\r\n        Updates the object\r\n        @param dt The time since the last frame in seconds\r\n        @param context The drawing context\r\n        @param xScroll The global scrolling value of the x axis\r\n        @param yScroll The global scrolling value of the y axis\r\n    */\r\n\tthis.update = function (/**Number*/ dt, /**CanvasRenderingContext2D*/context, /**Number*/ xScroll, /**Number*/ yScroll)\r\n    {\r\n        if (this.left)\r\n            this.x -= this.speed * dt;\r\n        if (this.right)\r\n            this.x += this.speed * dt;\r\n\r\n        // XOR operation (JavaScript does not have a native XOR operator)\r\n        // only test for a collision if the player is moving left or right (and not trying to do both at\r\n        // the same time)\r\n        if ((this.right || this.left) && !(this.left && this.right))\r\n        {\r\n            // this will be true until the player is no longer colliding\r\n            var collision = false;\r\n            // the player may have to be pushed back through several block stacks (especially if the\r\n            // frame rate is very slow)\r\n            do\r\n            {\r\n                // the current position of the player (test the left side if running left\r\n                // and the right side if running right)\r\n                var xPos = this.left ? this.x : this.x + this.frameWidth;\r\n                // the index of stack of blocks that the player is standing on/in\r\n                var currentBlock = this.level.currentBlock(xPos);\r\n                // the height of the stack of blocks that the player is standing on/in\r\n                var groundHeight = this.level.groundHeight(currentBlock);\r\n                // the height of the player (we need the height from the ground up,\r\n                // whereas the this.y value represents the position of the player\r\n                // from the \"sky\" down).\r\n                var playerHeight = context.canvas.height - (this.y + this.image.height);\r\n                // if the player is not higher than the stack of blocks, it must be colliding\r\n                if (playerHeight  < groundHeight)\r\n                {\r\n                    collision = true;\r\n                    // we are moving right, so push the player left\r\n                    if (this.right)\r\n                        this.x = this.level.blockWidth * currentBlock - this.frameWidth - 1;\r\n                    // we are moving left, push the player right\r\n                    else\r\n                        this.x = this.level.blockWidth * (currentBlock + 1);\r\n                }\r\n                else\r\n                {\r\n                    collision = false;\r\n                }\r\n            }  while (collision)\r\n        }\r\n\r\n        // keep the player bound to the level\r\n        if (this.x > this.level.blocks.length * this.level.blockWidth - this.frameWidth - 1)\r\n            this.x = this.level.blocks.length * this.level.blockWidth - this.frameWidth - 1;\r\n        if (this.x > context.canvas.width - this.frameWidth + xScroll -  this.screenBorder)\r\n            g_GameObjectManager.xScroll = this.x - (context.canvas.width - this.frameWidth -  this.screenBorder);\r\n        // modify the xScroll value to keep the player on the screen\r\n        if (this.x < 0)\r\n            this.x = 0;\r\n        if (this.x -  this.screenBorder < xScroll)\r\n            g_GameObjectManager.xScroll = this.x - this.screenBorder;\r\n\r\n        // if the player is jumping or falling, move along the sine wave\r\n        if (!this.grounded)\r\n        {\r\n            // the last position on the sine wave\r\n            var lastHeight = this.jumpSinWavePos;\r\n            // the new position on the sine wave\r\n            this.jumpSinWavePos += this.jumpSinWaveSpeed * dt;\r\n\r\n            // we have fallen off the bottom of the sine wave, so continue falling\r\n            // at a predetermined speed\r\n            if (this.jumpSinWavePos >= Math.PI)\r\n                 this.y += this.jumpHeight / this.jumpHangTime * this.fallMultiplyer * dt;\r\n            // otherwise move along the sine wave\r\n            else\r\n                this.y -= (Math.sin(this.jumpSinWavePos) - Math.sin(lastHeight)) * this.jumpHeight;\r\n        }\r\n\r\n        // now that the player has had it's y position changed we need to check for a collision\r\n        // with the ground below the player. we have to check both the players left and right sides\r\n        // for a collision with the ground\r\n\r\n        // left side\r\n        var currentBlock1 = this.level.currentBlock(this.x);\r\n        // right side\r\n        var currentBlock2 = this.level.currentBlock(this.x + this.frameWidth);\r\n        // ground height below the left side\r\n        var groundHeight1 = this.level.groundHeight(currentBlock1);\r\n        // ground height below the right side\r\n        var groundHeight2 = this.level.groundHeight(currentBlock2);\r\n        // the heighest point under the player\r\n        var maxGroundHeight = groundHeight1 > groundHeight2 ? groundHeight1 : groundHeight2;\r\n        // the players height (relaitive to the bottom of the screen)\r\n        var playerHeight = context.canvas.height - (this.y + this.image.height);\r\n\r\n        // we have hit the ground\r\n        if (maxGroundHeight >= playerHeight)\r\n        {\r\n            this.y = context.canvas.height - maxGroundHeight - this.image.height;\r\n            this.grounded = true;\r\n            this.jumpSinWavePos = 0;\r\n        }\r\n        // otherwise we are falling\r\n        else if (this.grounded)\r\n        {\r\n            this.grounded = false;\r\n            // starting falling down the sine wave (i.e. from the top)\r\n            this.jumpSinWavePos = this.halfPI;\r\n        }\r\n    }\r\n}\r\n\r\nPlayer.prototype = new AnimatedGameObject;"},{"id" : 10, "x" : 1153.25, "y" : 316.5, "width" : 166, "height" : 45, "nodename" : "Powerup", "txt" : "/**\r\n    Represents a powerup in the game\r\n    @author <a href=\"mailto:matthewcasperson@gmail.com\">Matthew Casperson</a>\r\n    @class\r\n*/\r\nfunction Powerup()\r\n{\r\n    /** The value of the powerup\r\n        @type Number\r\n     */\r\n    this.value = 0;\r\n    /** The current position on the sine wave\r\n        @type Number\r\n     */\r\n    this.sineWavePos = 0;\r\n    /** How quickly the powerup cycles through the sine wave\r\n        @type Number\r\n     */\r\n    this.bounceTime = 1;\r\n    /** The speed to increment the sineWavePos value at\r\n        @type Number\r\n     */\r\n    this.bounceSpeed = Math.PI / this.bounceTime;\r\n    /** The height of the powerups bounce\r\n        @type Number\r\n     */\r\n    this.bounceHeight = 10;\r\n\r\n    /**\r\n        Initialises this object\r\n        @param value        The value (score) of this powerup\r\n        @param image        The image to be displayed\r\n        @param x            The position on the X axis\r\n        @param y            The position on the Y axis\r\n        @param z            The depth\r\n        @param frameCount   The number of animation frames in the image\r\n        @param fps          The frames per second to animate this object at\r\n     */\r\n    this.startupPowerup = function(/**Number*/ value, /**Image*/ image, /**Number*/ x, /**Number*/ y, /**Number*/ z, /**Number*/ frameCount, /**Number*/ fps)\r\n    {\r\n        this.startupAnimatedGameObject(image, x, y - this.bounceHeight, z, frameCount, fps);\r\n        this.value = value;\r\n        return this;\r\n    }\r\n\r\n    this.shutdownPowerup = function()\r\n    {\r\n        this.shutdownAnimatedGameObject();\r\n    }\r\n\r\n    this.shutdown = function()\r\n    {\r\n        this.shutdownPowerup();\r\n    }\r\n\r\n    /**\r\n        Updates the object\r\n        @param dt The time since the last frame in seconds\r\n        @param context The drawing context\r\n        @param xScroll The global scrolling value of the x axis\r\n        @param yScroll The global scrolling value of the y axis\r\n    */\r\n\tthis.update = function (/**Number*/ dt, /**CanvasRenderingContext2D*/context, /**Number*/ xScroll, /**Number*/ yScroll)\r\n    {\r\n        var lastSineWavePos = this.sineWavePos;\r\n        this.sineWavePos += this.bounceSpeed * dt;\r\n        this.y += (Math.sin(this.sineWavePos) - Math.sin(lastSineWavePos)) * this.bounceHeight;\r\n\r\n        if (this.collisionArea().intersects(g_player.collisionArea()))\r\n        {\r\n            this.shutdown();\r\n            g_score += this.value;\r\n            g_ApplicationManager.updateScore();\r\n        }\r\n    }\r\n}\r\n\r\nPowerup.prototype = new AnimatedGameObject;"},{"id" : 11, "x" : 487, "y" : 477.25, "width" : 153, "height" : 45, "nodename" : "Rectangle", "txt" : "/**\r\n    A rectangle\r\n    @author <a href=\"mailto:matthewcasperson@gmail.com\">Matthew Casperson</a>\r\n    @class\r\n*/\r\nfunction Rectangle()\r\n{\r\n    this.left = 0;\r\n    this.top = 0;\r\n    this.width = 0;\r\n    this.height = 0;\r\n\r\n    /**\r\n        Initialises the object\r\n        @param left     Left position\r\n        @param top      Top Position\r\n        @param width    Width of rectangle\r\n        @param height   Height of triangle\r\n     */\r\n    this.startupRectangle = function(/**Number*/ left, /**Number*/ top, /**Number*/ width, /**Number*/ height)\r\n    {\r\n        this.left = left;\r\n        this.top = top;\r\n        this.width = width;\r\n        this.height = height;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n        @return         true if there is an intersection, false otherwise\r\n        @param other    The other rectangle to test against\r\n     */\r\n    this.intersects = function(/**Rectangle*/ other)\r\n    {\r\n        if (this.left + this.width < other.left)\r\n            return false;\r\n        if (this.top + this.height < other.top)\r\n            return false;\r\n        if (this.left > other.left + other.width)\r\n            return false;\r\n        if (this.top > other.top + other.height)\r\n            return false;\r\n\r\n        return true;\r\n    }\r\n}"},{"id" : 12, "x" : 916, "y" : 557.5, "width" : 149, "height" : 43, "nodename" : "RepeatingGameObject", "txt" : "/**\r\n    A class that display a repeating texture that can optionall be offset in either\r\n\tthe x or y axis\r\n    @author <a href=\"mailto:matthewcasperson@gmail.com\">Matthew Casperson</a>\r\n    @class\r\n*/\r\nfunction RepeatingGameObject()\r\n{\r\n    /** The width that the final image will take up\r\n\t\t@type Number\r\n\t*/\r\n\tthis.width = 0;\r\n\t/** The height that the final image will take up\r\n\t\t@type Number\r\n\t*/\r\n    this.height = 0;\r\n\t/** How much of the scrollX and scrollY to apply when drawing\r\n\t\t@type Number\r\n\t*/\r\n    this.scrollFactor = 1;\r\n\t\r\n    /**\r\n        Initialises this object\r\n        @return A reference to the initialised object\r\n    */\r\n    this.startupRepeatingGameObject = function(image, x, y, z, width, height, scrollFactor)\r\n    {\r\n        this.startupVisualGameObject(image, x, y, z);\r\n        this.width = width;\r\n        this.height = height;\r\n        this.scrollFactor = scrollFactor;\r\n        return this;\r\n    }\r\n\t\r\n    /**\r\n        Clean this object up\r\n    */\r\n    this.shutdownstartupRepeatingGameObject = function()\r\n    {\r\n        this.shutdownVisualGameObject();\r\n    }\r\n    \r\n\t/**\r\n        Draws this element to the back buffer\r\n        @param dt Time in seconds since the last frame\r\n\t\t@param context The context to draw to\r\n\t\t@param xScroll The global scrolling value of the x axis  \r\n\t\t@param yScroll The global scrolling value of the y axis  \r\n    */\r\n    this.draw = function(dt, canvas, xScroll, yScroll)\r\n    {\r\n        var areaDrawn = [0, 0];\r\n        \r\n        for (var y = 0; y < this.height; y += areaDrawn[1])\r\n        {\r\n            for (var x = 0; x < this.width; x += areaDrawn[0])\r\n            {\r\n                // the top left corner to start drawing the next tile from\r\n\t\t\t\tvar newPosition = [this.x + x, this.y + y];\r\n\t\t\t\t// the amount of space left in which to draw\r\n                var newFillArea = [this.width - x, this.height - y];\r\n\t\t\t\t// the first time around you have to start drawing from the middle of the image\r\n\t\t\t\t// subsequent tiles alwyas get drawn from the top or left\r\n                var newScrollPosition = [0, 0];\r\n                if (x==0) newScrollPosition[0] = xScroll * this.scrollFactor;\r\n                if (y==0) newScrollPosition[1] = yScroll * this.scrollFactor;\r\n                areaDrawn = this.drawRepeat(canvas, newPosition, newFillArea, newScrollPosition);\r\n            }\r\n        }\r\n    }\r\n    \r\n    this.drawRepeat = function(canvas, newPosition, newFillArea, newScrollPosition)\r\n    {\r\n        // find where in our repeating texture to start drawing (the top left corner)\r\n        var xOffset = Math.abs(newScrollPosition[0]) % this.image.width;\r\n        var yOffset = Math.abs(newScrollPosition[1]) % this.image.height;\r\n        var left = newScrollPosition[0]<0?this.image.width-xOffset:xOffset;\r\n        var top = newScrollPosition[1]<0?this.image.height-yOffset:yOffset;\r\n        var width = newFillArea[0] < this.image.width-left?newFillArea[0]:this.image.width-left;\r\n        var height = newFillArea[1] < this.image.height-top?newFillArea[1]:this.image.height-top;\r\n        \r\n        // draw the image\r\n        canvas.drawImage(this.image, left, top, width, height, newPosition[0], newPosition[1], width, height);\r\n        \r\n        return [width, height];\r\n    }\r\n    \r\n    \r\n}\r\nRepeatingGameObject.prototype = new VisualGameObject;"},{"id" : 13, "x" : 485, "y" : 316, "width" : 149, "height" : 45, "nodename" : "ResourceManager", "txt" : "/**\r\n    A database for the external resources used by the game\r\n    @author <a href=\"mailto:matthewcasperson@gmail.com\">Matthew Casperson</a>\r\n    @class\r\n*/\r\nfunction ResourceManager()\r\n{\r\n\t/** An array of the names of the images supplied to the startupResourceManager\r\n\t\tfunction. Since the images are referenced by creating new properties\r\n\t\tof the ResourceManager class this collection allows a developer to \r\n\t\tknow which of the ResourceManager properties are images, and (by \r\n\t\telimination) those that are not\r\n\t\t@type Array\r\n\t*/\r\n    this.imageProperties = null;\r\n\r\n\t/**\r\n        Initialises this object\r\n\t\t@param images\tAn array of objects with the name and src properties\r\n        @return \t\tA reference to the initialised object\r\n    */\r\n    this.startupResourceManager = function(/**Array*/ images)\r\n    {\r\n        // set the global variable\r\n\t\tg_ResourceManager = this;\r\n\r\n        // initialize internal state.\r\n        this.imageProperties = new Array();\r\n\r\n        // for each image, call preload()\r\n        for ( var i = 0; i < images.length; i++ )\r\n\t\t{\r\n\t\t\t// create new Image object and add to array\r\n\t\t\tvar thisImage = new Image;\r\n\t\t\tthis[images[i].name] = thisImage;\r\n\t\t\tthis.imageProperties.push(images[i].name);\r\n\r\n\t\t\t// assign the .src property of the Image object\r\n\t\t\tthisImage.src = images[i].src;\r\n\t\t}\r\n\r\n        return this;\r\n    }\r\n}"},{"id" : 14, "x" : 489, "y" : 596, "width" : 155, "height" : 42, "nodename" : "Utils", "txt" : "/**\r\n    Removes a number of objects from the array\r\n    @param from The first object to remove\r\n    @param to (Optional) The last object to remove\r\n*/\r\nArray.prototype.remove = function(/**Number*/ from, /**Number*/ to)\r\n{\r\n  var rest = this.slice((to || from) + 1 || this.length);\r\n  this.length = from < 0 ? this.length + from : from;\r\n  return this.push.apply(this, rest);\r\n};\r\n\r\n/**\r\n    Removes a specific object from the array\r\n    @param object The object to remove\r\n*/\r\nArray.prototype.removeObject = function(object)\r\n{\r\n    for (var i = 0; i < this.length; ++i)\r\n    {\r\n        if (this[i] === object)\r\n        {\r\n            this.remove(i);\r\n            break;\r\n        }\r\n    }\r\n}"},{"id" : 15, "x" : 698, "y" : 396, "width" : 152, "height" : 43, "nodename" : "VisualGameObject", "txt" : "/**\r\n    The base class for all elements that appear in the game.\r\n    @author <a href=\"mailto:matthewcasperson@gmail.com\">Matthew Casperson</a>\r\n    @class\r\n*/\r\nfunction VisualGameObject()\r\n{\r\n    /**\r\n        The image that will be displayed by this object\r\n        @type Image\r\n    */\r\n    this.image = null;\r\n    \r\n    /**\r\n        Draws this element to the back buffer\r\n        @param dt Time in seconds since the last frame\r\n\t\t@param context The context to draw to\r\n\t\t@param xScroll The global scrolling value of the x axis  \r\n\t\t@param yScroll The global scrolling value of the y axis  \r\n    */\r\n    this.draw = function(/**Number*/ dt, /**CanvasRenderingContext2D*/ context, /**Number*/ xScroll, /**Number*/ yScroll)\r\n    {\r\n        context.drawImage(this.image, this.x - xScroll, this.y - yScroll);\r\n    }\r\n    \r\n    /**\r\n        Initialises this object\r\n        @param image The image to be displayed\r\n\t\t@param x The position on the X axis\r\n        @param y The position on the Y axis\r\n\t\t@param z The depth\r\n    */\r\n    this.startupVisualGameObject = function(/**Image*/ image, /**Number*/ x, /**Number*/ y, /**Number*/ z)\r\n    {\r\n        this.startupGameObject(x, y, z);\r\n        this.image = image;\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n        Clean this object up\r\n    */\r\n    this.shutdownVisualGameObject = function()\r\n    {\r\n        this.image = null;\r\n        this.shutdownGameObject();\r\n    }\r\n\r\n    this.shutdown = function()\r\n    {\r\n        this.shutdownVisualGameObject();\r\n    }\r\n\r\n    this.collisionArea = function()\r\n    {\r\n        return new Rectangle().startupRectangle(this.x, this.y, this.image.width, this.image.height);\r\n    }\r\n}\r\nVisualGameObject.prototype = new GameObject;"}], "connections" : [{"nodeA" : 3, "nodeB" : 15, "conA" : "right", "conB" : "left"},{"nodeA" : 15, "nodeB" : 8, "conA" : "right", "conB" : "left"},{"nodeA" : 15, "nodeB" : 1, "conA" : "right", "conB" : "left"},{"nodeA" : 15, "nodeB" : 12, "conA" : "right", "conB" : "left"},{"nodeA" : 1, "nodeB" : 10, "conA" : "right", "conB" : "left"},{"nodeA" : 1, "nodeB" : 6, "conA" : "right", "conB" : "left"},{"nodeA" : 1, "nodeB" : 9, "conA" : "right", "conB" : "left"}]}